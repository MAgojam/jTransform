
# This file is automatically generated, you probably don't want to edit this

jtMergeColsOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "jtMergeColsOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            varBy = NULL,
            varAll = NULL,
            fleInp = "",
            fleChs = NULL,
            typMrg = "outer",
            btnCrt = NULL, ...) {

            super$initialize(
                package="jTransform",
                name="jtMergeCols",
                requiresData=TRUE,
                ...)

            private$..varBy <- jmvcore::OptionVariables$new(
                "varBy",
                varBy,
                permitted=list(
                    "numeric",
                    "factor",
                    "id"))
            private$..varAll <- jmvcore::OptionVariables$new(
                "varAll",
                varAll,
                hidden=TRUE,
                permitted=list(
                    "numeric",
                    "factor",
                    "id"))
            private$..fleInp <- jmvcore::OptionString$new(
                "fleInp",
                fleInp,
                default="")
            private$..fleChs <- jmvcore::OptionString$new(
                "fleChs",
                fleChs,
                hidden=TRUE)
            private$..typMrg <- jmvcore::OptionList$new(
                "typMrg",
                typMrg,
                options=list(
                    "outer",
                    "inner",
                    "left",
                    "right"),
                default="outer")
            private$..btnCrt <- jmvcore::OptionAction$new(
                "btnCrt",
                btnCrt)

            self$.addOption(private$..varBy)
            self$.addOption(private$..varAll)
            self$.addOption(private$..fleInp)
            self$.addOption(private$..fleChs)
            self$.addOption(private$..typMrg)
            self$.addOption(private$..btnCrt)
        }),
    active = list(
        varBy = function() private$..varBy$value,
        varAll = function() private$..varAll$value,
        fleInp = function() private$..fleInp$value,
        fleChs = function() private$..fleChs$value,
        typMrg = function() private$..typMrg$value,
        btnCrt = function() private$..btnCrt$value),
    private = list(
        ..varBy = NA,
        ..varAll = NA,
        ..fleInp = NA,
        ..fleChs = NA,
        ..typMrg = NA,
        ..btnCrt = NA)
)

jtMergeColsResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "jtMergeColsResults",
    inherit = jmvcore::Group,
    active = list(
        genInf = function() private$.items[["genInf"]],
        pvwDta = function() private$.items[["pvwDta"]],
        addInf = function() private$.items[["addInf"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Add columns (from other data sets)")
            self$add(jmvcore::Html$new(
                options=options,
                name="genInf",
                clearWith=list(
                    "varBy",
                    "varAll",
                    "fleInp")))
            self$add(jmvcore::Table$new(
                options=options,
                name="pvwDta",
                title="Data Preview",
                refs=list(
                    "jTransform",
                    "jmvReadWrite"),
                clearWith=list(
                    "varBy",
                    "varAll",
                    "fleInp"),
                rows=1,
                columns=list(
                    list(
                        `name`="fstCol", 
                        `title`=""))))
            self$add(jmvcore::Html$new(
                options=options,
                name="addInf",
                clearWith=list(),
                content="<h2>Details</h2> <p>There are four different types of merging operations: The first option keeps all cases (but columns in the resulting data set may be empty if they did not contain values in same input data sets), the second option keeps only those cases where all datasets contain the same value in the matching variable, for \u201Cleft\u201D all cases from the first data set are kept (whereas cases that are only contained in input data set two or higher are dropped), for \u201Cright\u201D all cases from the second (or any higher) data set are kept.</p>\n"))}))

jtMergeColsBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "jtMergeColsBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "jTransform",
                name = "jtMergeCols",
                version = c(1,0,0),
                options = options,
                results = jtMergeColsResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = TRUE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Add columns (from other data sets)
#'
#' Add columns (from other data sets)
#'
#' @examples
#' \dontrun{
#' # the function is a wrapper for jmvReadWrite::merge_cols_omv
#' # please use that function when in R (or in Rj)
#' # for more information: https://sjentsch.github.io/jmvReadWrite
#'}
#' @param data the data as a data frame
#' @param varBy .
#' @param varAll .
#' @param fleInp .
#' @param fleChs .
#' @param typMrg .
#' @param btnCrt .
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$genInf} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$pvwDta} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$addInf} \tab \tab \tab \tab \tab a html \cr
#' }
#'
#' Tables can be converted to data frames with \code{asDF} or \code{\link{as.data.frame}}. For example:
#'
#' \code{results$pvwDta$asDF}
#'
#' \code{as.data.frame(results$pvwDta)}
#'
#' @export
jtMergeCols <- function(
    data,
    varBy,
    varAll,
    fleInp = "",
    fleChs,
    typMrg = "outer",
    btnCrt) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("jtMergeCols requires jmvcore to be installed (restart may be required)")

    if ( ! missing(varBy)) varBy <- jmvcore::resolveQuo(jmvcore::enquo(varBy))
    if ( ! missing(varAll)) varAll <- jmvcore::resolveQuo(jmvcore::enquo(varAll))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(varBy), varBy, NULL),
            `if`( ! missing(varAll), varAll, NULL))


    options <- jtMergeColsOptions$new(
        varBy = varBy,
        varAll = varAll,
        fleInp = fleInp,
        fleChs = fleChs,
        typMrg = typMrg,
        btnCrt = btnCrt)

    analysis <- jtMergeColsClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

