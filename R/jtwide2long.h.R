
# This file is automatically generated, you probably don't want to edit this

jtWide2LongOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "jtWide2LongOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            mdeW2L = "Sep",
            id_Sep = NULL,
            xfmSep = NULL,
            excSep = NULL,
            pfxSep = "cond",
            chrSep = "_",
            lvlSep = "",
            id_NSS = NULL,
            xfmNSS = NULL,
            excNSS = NULL,
            idxNSS = "index",
            tgtNSS = "var",
            id_NSA = NULL,
            xfmNSA = list(
                list(label="long_y", vars=list())),
            excNSA = NULL,
            idxNSA = list(
                list(var="index1", levels=0)),
            btnCrt = NULL, ...) {

            super$initialize(
                package="jTransform",
                name="jtWide2Long",
                requiresData=TRUE,
                ...)

            private$..mdeW2L <- jmvcore::OptionList$new(
                "mdeW2L",
                mdeW2L,
                options=list(
                    "Sep",
                    "NSS",
                    "NSA"),
                default="Sep")
            private$..id_Sep <- jmvcore::OptionVariables$new(
                "id_Sep",
                id_Sep,
                permitted=list(
                    "numeric",
                    "factor",
                    "id"))
            private$..xfmSep <- jmvcore::OptionVariables$new(
                "xfmSep",
                xfmSep,
                permitted=list(
                    "numeric",
                    "factor",
                    "id"))
            private$..excSep <- jmvcore::OptionVariables$new(
                "excSep",
                excSep,
                permitted=list(
                    "numeric",
                    "factor",
                    "id"))
            private$..pfxSep <- jmvcore::OptionString$new(
                "pfxSep",
                pfxSep,
                default="cond")
            private$..chrSep <- jmvcore::OptionString$new(
                "chrSep",
                chrSep,
                default="_")
            private$..lvlSep <- jmvcore::OptionString$new(
                "lvlSep",
                lvlSep,
                default="")
            private$..id_NSS <- jmvcore::OptionVariables$new(
                "id_NSS",
                id_NSS,
                permitted=list(
                    "numeric",
                    "factor",
                    "id"))
            private$..xfmNSS <- jmvcore::OptionVariables$new(
                "xfmNSS",
                xfmNSS)
            private$..excNSS <- jmvcore::OptionVariables$new(
                "excNSS",
                excNSS,
                permitted=list(
                    "numeric",
                    "factor",
                    "id"))
            private$..idxNSS <- jmvcore::OptionString$new(
                "idxNSS",
                idxNSS,
                default="index")
            private$..tgtNSS <- jmvcore::OptionString$new(
                "tgtNSS",
                tgtNSS,
                default="var")
            private$..id_NSA <- jmvcore::OptionVariables$new(
                "id_NSA",
                id_NSA,
                permitted=list(
                    "numeric",
                    "factor",
                    "id"))
            private$..xfmNSA <- jmvcore::OptionArray$new(
                "xfmNSA",
                xfmNSA,
                default=list(
                    list(label="long_y", vars=list())),
                template=jmvcore::OptionGroup$new(
                    "xfmNSA",
                    NULL,
                    elements=list(
                        jmvcore::OptionString$new(
                            "label",
                            NULL),
                        jmvcore::OptionVariables$new(
                            "vars",
                            NULL))))
            private$..excNSA <- jmvcore::OptionVariables$new(
                "excNSA",
                excNSA,
                permitted=list(
                    "numeric",
                    "factor",
                    "id"))
            private$..idxNSA <- jmvcore::OptionArray$new(
                "idxNSA",
                idxNSA,
                default=list(
                    list(var="index1", levels=0)),
                template=jmvcore::OptionGroup$new(
                    "idxNSA",
                    NULL,
                    elements=list(
                        jmvcore::OptionString$new(
                            "var",
                            NULL),
                        jmvcore::OptionInteger$new(
                            "levels",
                            NULL))))
            private$..btnCrt <- jmvcore::OptionAction$new(
                "btnCrt",
                btnCrt)

            self$.addOption(private$..mdeW2L)
            self$.addOption(private$..id_Sep)
            self$.addOption(private$..xfmSep)
            self$.addOption(private$..excSep)
            self$.addOption(private$..pfxSep)
            self$.addOption(private$..chrSep)
            self$.addOption(private$..lvlSep)
            self$.addOption(private$..id_NSS)
            self$.addOption(private$..xfmNSS)
            self$.addOption(private$..excNSS)
            self$.addOption(private$..idxNSS)
            self$.addOption(private$..tgtNSS)
            self$.addOption(private$..id_NSA)
            self$.addOption(private$..xfmNSA)
            self$.addOption(private$..excNSA)
            self$.addOption(private$..idxNSA)
            self$.addOption(private$..btnCrt)
        }),
    active = list(
        mdeW2L = function() private$..mdeW2L$value,
        id_Sep = function() private$..id_Sep$value,
        xfmSep = function() private$..xfmSep$value,
        excSep = function() private$..excSep$value,
        pfxSep = function() private$..pfxSep$value,
        chrSep = function() private$..chrSep$value,
        lvlSep = function() private$..lvlSep$value,
        id_NSS = function() private$..id_NSS$value,
        xfmNSS = function() private$..xfmNSS$value,
        excNSS = function() private$..excNSS$value,
        idxNSS = function() private$..idxNSS$value,
        tgtNSS = function() private$..tgtNSS$value,
        id_NSA = function() private$..id_NSA$value,
        xfmNSA = function() private$..xfmNSA$value,
        excNSA = function() private$..excNSA$value,
        idxNSA = function() private$..idxNSA$value,
        btnCrt = function() private$..btnCrt$value),
    private = list(
        ..mdeW2L = NA,
        ..id_Sep = NA,
        ..xfmSep = NA,
        ..excSep = NA,
        ..pfxSep = NA,
        ..chrSep = NA,
        ..lvlSep = NA,
        ..id_NSS = NA,
        ..xfmNSS = NA,
        ..excNSS = NA,
        ..idxNSS = NA,
        ..tgtNSS = NA,
        ..id_NSA = NA,
        ..xfmNSA = NA,
        ..excNSA = NA,
        ..idxNSA = NA,
        ..btnCrt = NA)
)

jtWide2LongResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "jtWide2LongResults",
    inherit = jmvcore::Group,
    active = list(
        genInf = function() private$.items[["genInf"]],
        pvwDta = function() private$.items[["pvwDta"]],
        pvwLvl = function() private$.items[["pvwLvl"]],
        addInf = function() private$.items[["addInf"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Transform dataset from wide to long")
            self$add(jmvcore::Html$new(
                options=options,
                name="genInf",
                clearWith=list(
                    "mdeW2L")))
            self$add(jmvcore::Table$new(
                options=options,
                name="pvwDta",
                title="Data Preview",
                refs=list(
                    "jTransform",
                    "jmvReadWrite"),
                clearWith=list(
                    "mdeW2L",
                    "id_Sep",
                    "id_NSS",
                    "id_NSA",
                    "xfmSep",
                    "xfmNSS",
                    "xfmNSA",
                    "excSep",
                    "excNSS",
                    "excNSA",
                    "idxNSS",
                    "idxNSA",
                    "pfxSep",
                    "chrSep",
                    "lvlSep",
                    "tgtNSS"),
                rows=1,
                columns=list(
                    list(
                        `name`="fstCol", 
                        `title`=""))))
            self$add(jmvcore::Table$new(
                options=options,
                name="pvwLvl",
                title="Repeated-Measures Levels",
                clearWith=list(
                    "mdeW2L",
                    "id_Sep",
                    "id_NSS",
                    "id_NSA",
                    "xfmSep",
                    "xfmNSS",
                    "xfmNSA",
                    "excSep",
                    "excNSS",
                    "excNSA",
                    "idxNSS",
                    "idxNSA",
                    "pfxSep",
                    "chrSep",
                    "lvlSep",
                    "tgtNSS"),
                columns=list(
                    list(
                        `name`="fstCol", 
                        `title`=""))))
            self$add(jmvcore::Html$new(
                options=options,
                name="addInf",
                clearWith=list(
                    "mdeW2L"),
                content=""))}))

jtWide2LongBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "jtWide2LongBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "jTransform",
                name = "jtWide2Long",
                version = c(1,0,0),
                options = options,
                results = jtWide2LongResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = TRUE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Transform dataset from wide to long
#'
#' Transform dataset from wide to long
#'
#' @examples
#' \dontrun{
#' # the function is a wrapper for jmvReadWrite::wide2long_omv
#' # please use that function when in R (or in Rj)
#' # for more information: https://sjentsch.github.io/jmvReadWrite
#'}
#' @param data .
#' @param mdeW2L .
#' @param id_Sep .
#' @param xfmSep .
#' @param excSep .
#' @param pfxSep .
#' @param chrSep .
#' @param lvlSep .
#' @param id_NSS .
#' @param xfmNSS .
#' @param excNSS .
#' @param idxNSS .
#' @param tgtNSS .
#' @param id_NSA .
#' @param xfmNSA .
#' @param excNSA .
#' @param idxNSA .
#' @param btnCrt .
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$genInf} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$pvwDta} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$pvwLvl} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$addInf} \tab \tab \tab \tab \tab a html \cr
#' }
#'
#' Tables can be converted to data frames with \code{asDF} or \code{\link{as.data.frame}}. For example:
#'
#' \code{results$pvwDta$asDF}
#'
#' \code{as.data.frame(results$pvwDta)}
#'
#' @export
jtWide2Long <- function(
    data,
    mdeW2L = "Sep",
    id_Sep,
    xfmSep,
    excSep,
    pfxSep = "cond",
    chrSep = "_",
    lvlSep = "",
    id_NSS,
    xfmNSS,
    excNSS,
    idxNSS = "index",
    tgtNSS = "var",
    id_NSA,
    xfmNSA = list(
                list(label="long_y", vars=list())),
    excNSA,
    idxNSA = list(
                list(var="index1", levels=0)),
    btnCrt) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("jtWide2Long requires jmvcore to be installed (restart may be required)")

    if ( ! missing(id_Sep)) id_Sep <- jmvcore::resolveQuo(jmvcore::enquo(id_Sep))
    if ( ! missing(xfmSep)) xfmSep <- jmvcore::resolveQuo(jmvcore::enquo(xfmSep))
    if ( ! missing(excSep)) excSep <- jmvcore::resolveQuo(jmvcore::enquo(excSep))
    if ( ! missing(id_NSS)) id_NSS <- jmvcore::resolveQuo(jmvcore::enquo(id_NSS))
    if ( ! missing(xfmNSS)) xfmNSS <- jmvcore::resolveQuo(jmvcore::enquo(xfmNSS))
    if ( ! missing(excNSS)) excNSS <- jmvcore::resolveQuo(jmvcore::enquo(excNSS))
    if ( ! missing(id_NSA)) id_NSA <- jmvcore::resolveQuo(jmvcore::enquo(id_NSA))
    if ( ! missing(excNSA)) excNSA <- jmvcore::resolveQuo(jmvcore::enquo(excNSA))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(id_Sep), id_Sep, NULL),
            `if`( ! missing(xfmSep), xfmSep, NULL),
            `if`( ! missing(excSep), excSep, NULL),
            `if`( ! missing(id_NSS), id_NSS, NULL),
            `if`( ! missing(xfmNSS), xfmNSS, NULL),
            `if`( ! missing(excNSS), excNSS, NULL),
            `if`( ! missing(id_NSA), id_NSA, NULL),
            `if`( ! missing(excNSA), excNSA, NULL))


    options <- jtWide2LongOptions$new(
        mdeW2L = mdeW2L,
        id_Sep = id_Sep,
        xfmSep = xfmSep,
        excSep = excSep,
        pfxSep = pfxSep,
        chrSep = chrSep,
        lvlSep = lvlSep,
        id_NSS = id_NSS,
        xfmNSS = xfmNSS,
        excNSS = excNSS,
        idxNSS = idxNSS,
        tgtNSS = tgtNSS,
        id_NSA = id_NSA,
        xfmNSA = xfmNSA,
        excNSA = excNSA,
        idxNSA = idxNSA,
        btnCrt = btnCrt)

    analysis <- jtWide2LongClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

